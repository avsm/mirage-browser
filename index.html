<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>jQuery UI Example Page</title>
    <link type="text/css" href="css/humanity/jquery-ui-1.8.14.custom.css" rel="stylesheet" />  
    <link type="text/css" href="css/layout-default-latest.css" rel="stylesheet" />  
    <script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.layout-latest.js"></script>
    <style type="text/css">
      /*demo page css*/
      body{ font: 62.5% "Trebuchet MS", sans-serif; margin: 50px;}
      .demoHeaders { margin-top: 2em; }
      #dialog_link {padding: .4em 1em .4em 20px;text-decoration: none;position: relative;}
      #dialog_link span.ui-icon {margin: 0 5px 0 0;position: absolute;left: .2em;top: 50%;margin-top: -8px;}
      ul#icons {margin: 0; padding: 0;}
      ul#icons li {margin: 2px; position: relative; padding: 4px 0; cursor: pointer; float: left;  list-style: none;}
      ul#icons span.ui-icon {float: left; margin: 0 4px;}
    </style>  
    <script type="text/javascript">
      var layout;

  $(document).ready(function () {

    layout = $('body').layout({
      closable: true, resizable: true, slidable: true,
       north__slidable:    false  // OVERRIDE the pane-default of 'slidable=true'
    ,  north__togglerLength_closed: '100%'  // toggle-button is full-width of resizer-bar
    ,  north__spacing_closed:  20    // big resizer-bar when open (zero height)
    ,  south__resizable:    false  // OVERRIDE the pane-default of 'resizable=true'
    ,  south__spacing_open:  0    // no resizer-bar when open (zero height)
    ,  south__spacing_closed:  20    // big resizer-bar when open (zero height)
    ,  west__minSize:      100
    ,  center__minWidth:    100
    ,  useStateCookie:      true
    });
    // if there is no state-cookie, then DISABLE state management initially
    var cookieExists = false;
    for (var key in layout.getCookie()) {
      cookieExists = true;
      break
    }
    layout.toggle('east');
    //if (!cookieExists) toggleStateManagement( true );

    var selectedMenu = "unknown";

    function signame(x) { return ('sig'+x); }
    function modname(x) { return ('mod'+x); }

    function generateSigFun(modname, v) {
      var f = $("<div />").addClass('sig-fun');
      var fnname = v.name.replace(modname+'.','');
      f.append(
        $("<div/>").addClass('sig-fun-type').html(
          $("<span/>").addClass('sig-fun-type-start').text('val '+fnname+' : '),
          $("<span/>").addClass('sig-fun-type-body').text(v.type)
        )
      );
      f.append($("<div />").addClass('sig-fun-descr').html(v.info.description));
      return f;
    }
    function generateSig(data,sigdata) {
      var name=data.name;
      var modstruct = sigdata.module.module_structure;
      var d = $("<div />").attr('id', signame(name));
      d.append($("<div />").addClass('sig-header').text(sigdata.module.name));
      d.append($("<div />").addClass('sig-info').html(sigdata.module.info.description));
      $.each(sigdata.module.module_structure, function(e) {
         var x = sigdata.module.module_structure[e];
         if (x.comment) {
           d.append($("<div />").addClass('sig-comment').html(x.comment));
         } else if (x.value) {
           d.append(generateSigFun(name, x.value));
         }
       });
      return d;
    }

    $('#ocaml_sigs').hide();
    $.ajax({
      url: 'data/index.json',
      dataType: 'json',
      error: function(x) { console.log('ERR'+x); },
      success: function(data) {
        $.each(data, function(i) {
          var name=data[i].name;
          $.ajax({
           url: 'data/'+name+'.json',
           dataType: 'json',
           error: function(x) { console.log('ERR2'+x); },
           success: function(sigdata) {
             $('#ocaml_sigs').append(generateSig(data[i], sigdata)); 
             $('#ocaml_modules').append(
               $('<div />').attr('id',modname(name)).text(name));
             $('#'+modname(name)).click(function () { 
                $('#'+selectedMenu).removeClass('ui-selected');
                selectedMenu=modname(name);
                $('#'+selectedMenu).addClass('ui-selected');
                $('#current_sig').html($('#'+signame(name)));
              });
           }});
        });
      }
    });
  
   });

   

    </script>
   
  </head>
  <body>
   <div id="ocaml_sigs"></div>
   <div class="ui-layout-south">
   </div>
   <div class="ui-layout-north">
   </div>
   <div class="ui-layout-west">
     <div id="ocaml_modules"></div>
   </div>
   <div class="ui-layout-east">
   </div>
   <div class="ui-layout-center">
    <div id="current_sig" />
   </div>
 </body>
</html>
